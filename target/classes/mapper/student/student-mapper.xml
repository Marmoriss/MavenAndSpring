<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="student">

    <!-- parameterType은 생략 가능하다. -->
    <insert id="insertStudent" parameterType="student">
        insert into
            student (no, name, tel)
        values (
            seq_student_no.nextval, #{name}, #{tel})
    </insert>
    
    <insert id="insertStudentMap" parameterType="map">
        insert into
            student (no, name, tel)
        values (
            seq_student_no.nextval, #{name}, #{tel})
    </insert>
    
    <!-- select 태그는 resultType/resultMap 속성을 반드시 작성해야 한다. -->
    <select id="getTotalCount" resultType="_int">
        select
            count(*)
        from 
            student 
        where
            deleted_at is null
    </select>
    
    <select id="selectOneStudent" resultMap="studentDtoMap">
        select
            no,
            name,
            tel,
            created_at,
            updated_at,
            deleted_at
        from
            student
        where
            no = #{no}
            and
            deleted_at is null
    </select>
    
    <select id="selectStudentList" resultMap="studentDtoMap">
        select
            *
        from
            student
        where
            deleted_at is null
        order by
            no
    </select>
    
    <resultMap type ="student" id="studentDtoMap">
        <!-- PK는 id로 나머지 컬럼은 result로 작성 -->
        <!-- column은 db컬럼명(대소문자 구분x), property는 자바 변수명(대소문자 구분o) -->
        <!-- 기본적으로 같은 이름의 컬럼을 찾기때문에 아래의 코드를 생략해도 무방하다. -->
        <id column="no" property="no"/>
        <result column="name" property="name"/>
        <result column="tel" property="tel"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
        <result column="deleted_at" property="deletedAt"/>
    </resultMap>
    
    <select id="selectOneStudentMap" resultMap="studentMap">
        select
            *
        from
            student
        where
            no = #{no}
            and
            deleted_at is null
    </select>
    
    <select id="selectStudentMapList" resultMap="studentMap">
        select
            *
        from
            student
        where
            deleted_at is null
        order by
            no
    </select>
    
    <resultMap type="map" id="studentMap">
        <id column="no" property="no"/>
        <result column="name" property="name"/>
        <result column="tel" property="tel"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
        <result column="deleted_at" property="deletedAt"/>
    </resultMap>
    
    <update id="updateStudent">
        update
            student
        set
           name = #{name},
           tel = #{tel},
           updated_at = sysdate
        where
            no = #{no}
            and
            deleted_at is null
    </update>
    <update id="deleteStudent">
        update
            student
        set
           deleted_at = sysdate
        where
            no = #{no}
    </update>
</mapper>